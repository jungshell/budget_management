rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 예산 데이터 - 개발 단계에서는 모든 읽기/쓰기 허용
    match /budgets/{budgetId} {
      allow read, write: if true;
    }
    
    // 사업 데이터
    match /projects/{projectId} {
      allow read, write: if true;
    }
    
    // 사용자 설정
    match /users/{userId} {
      // 모든 사용자는 자신의 프로필 읽기 가능
      allow read: if request.auth != null;
      // 자신의 프로필은 수정 가능 (단, role은 제외)
      allow update: if request.auth != null && request.auth.uid == userId && 
        !('role' in request.resource.data.diff(resource.data).keys());
      // 관리자만 다른 사용자의 role 변경 가능
      allow update: if request.auth != null && 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin' &&
        'role' in request.resource.data.diff(resource.data).keys();
      // 새 사용자 생성은 인증된 사용자 모두 가능
      allow create: if request.auth != null;
    }
    
    // 지침 데이터
    match /guidelines/{guidelineId} {
      allow read, write: if true;
    }
    
    // 활동 로그
    match /activities/{activityId} {
      allow read, write: if true;
    }
    
    // 예산 변경 이력
match /budget_history/{historyId} {
  allow read, write: if true;
}

match /backups/{backupId} {
  allow read, write: if true;
}

match /budget_templates/{templateId} {
  allow read, write: if true;
}
  }
}

