# Google Apps Script 코드 업데이트 가이드

## ⚠️ 중요: 변경사항이 적용되지 않는 경우

코드를 수정하고 저장했지만 변경사항이 반영되지 않는다면, **반드시 "새 버전으로 배포"**해야 합니다!

## 📋 업데이트 절차

### 1단계: Google Apps Script 편집기 열기

1. [Google Apps Script](https://script.google.com) 접속
2. 기존 프로젝트 열기 (또는 새 프로젝트 생성)

### 2단계: 전체 코드 교체

1. 편집기에서 **모든 기존 코드를 선택하고 삭제**
2. `GOOGLE_APPS_SCRIPT_FULL_CODE.js` 파일의 **전체 내용을 복사**
3. 편집기에 붙여넣기
4. **저장** (Ctrl+S 또는 Cmd+S)

### 3단계: 새 버전으로 배포 (가장 중요!)

1. 상단 메뉴에서 **"배포"** 클릭
2. **"배포 관리"** 선택
3. 기존 배포 항목 옆의 **연필 아이콘(편집)** 클릭
4. **"버전"** 드롭다운에서 **"새 버전"** 선택
5. **"배포"** 버튼 클릭
6. **새 Web App URL이 생성되면 복사** (이전 URL과 다를 수 있음)

### 4단계: 설정 페이지에서 URL 업데이트

1. 예산 관리 시스템의 **설정 페이지**로 이동
2. **"Google Apps Script Web App URL"** 필드에 **새 URL 입력**
3. **저장**

### 5단계: 테스트

1. 예산 페이지로 이동
2. **"Google Sheets로 내보내기"** 클릭
3. 생성된 Google Sheet 확인:
   - ✅ 숫자에 천 단위 구분 쉼표가 표시되는지
   - ✅ 산식오류 컬럼에 "정상" 또는 "오류"가 표시되는지
   - ✅ 스프레드시트 제목이 "연도_회차_날짜" 형식인지 (예: `2024_본예산_241208`)
   - ✅ 오류가 있는 행이 빨간색으로 표시되는지

## 🔍 문제 해결

### 문제 1: 여전히 변경사항이 적용되지 않음

**원인**: 캐시 문제 또는 잘못된 URL 사용

**해결 방법**:
1. 브라우저 캐시 완전 삭제 (Ctrl+Shift+Delete)
2. 시크릿 모드에서 테스트
3. Web App URL이 `/exec`로 끝나는지 확인 (`/dev`가 아님)
4. Google Apps Script에서 **"실행"** > **"doPost"** 실행하여 권한 재승인

### 문제 2: 산식오류가 모두 "정상"으로 표시됨

**원인**: 수식이 제대로 적용되지 않음

**해결 방법**:
1. Google Sheets에서 **"산식오류"** 컬럼의 수식을 확인
2. 수식이 `=IF(ABS(C3-AN3)>1000,"오류","정상")` 형식인지 확인
3. Google Apps Script 코드의 `errorFormula` 부분 확인 (265번째 줄 근처)

### 문제 3: 숫자 형식이 적용되지 않음

**원인**: `setNumberFormat`이 실행되지 않음

**해결 방법**:
1. Google Sheets에서 해당 셀 선택
2. **"서식"** > **"숫자"** > **"숫자"** 선택
3. Google Apps Script 코드의 `setNumberFormat('#,##0')` 부분 확인 (292-295번째 줄)

### 문제 4: 스프레드시트 제목이 변경되지 않음

**원인**: 제목 설정 코드가 실행되지 않음

**해결 방법**:
1. Google Apps Script 코드의 `spreadsheetTitle` 생성 부분 확인 (90-95번째 줄)
2. `spreadsheet.rename(spreadsheetTitle)` 호출 확인 (109번째 줄)
3. 새 스프레드시트를 생성하여 테스트 (기존 ID 삭제 후 내보내기)

## 📝 확인 체크리스트

업데이트 후 다음 사항을 확인하세요:

- [ ] Google Apps Script 코드가 최신 버전으로 업데이트됨
- [ ] "새 버전으로 배포" 완료
- [ ] 새 Web App URL이 설정 페이지에 입력됨
- [ ] 숫자에 천 단위 구분 쉼표 표시됨
- [ ] 산식오류 컬럼에 "정상" 또는 "오류" 표시됨
- [ ] 오류가 있는 행이 빨간색으로 표시됨
- [ ] 스프레드시트 제목이 올바른 형식으로 표시됨
- [ ] 0인 열이 자동으로 숨겨짐
- [ ] 시군비 상세 탭이 생성됨

## 💡 참고사항

- Google Apps Script는 코드를 수정해도 **자동으로 배포되지 않습니다**
- 반드시 **"새 버전으로 배포"**를 해야 변경사항이 적용됩니다
- 배포 후 URL이 변경될 수 있으므로, 설정 페이지에서 URL을 업데이트해야 합니다
- 기존 스프레드시트를 사용하는 경우, 새로 생성된 스프레드시트와 비교하여 확인하세요

